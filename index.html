<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>é£²æ–™é»é¤ç³»çµ±</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .content {
      padding: 30px;
    }

    .section {
      margin-bottom: 30px;
      padding: 20px;
      border-radius: 10px;
      background: #f8f9fa;
      border-left: 4px solid #667eea;
    }

    .section h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }

    select, input[type="text"], input[type="file"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      margin: 5px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-danger {
      background: linear-gradient(45deg, #ff6b6b, #ee5a52);
    }

    .btn-success {
      background: linear-gradient(45deg, #48cae4, #0077b6);
    }

    .menu-item {
      background: white;
      margin-bottom: 15px;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #eee;
      transition: all 0.3s;
    }

    .menu-item:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .menu-item.selected {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .drink-info {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .drink-info input[type="radio"] {
      margin-right: 10px;
      transform: scale(1.2);
    }

    .drink-name {
      font-weight: 600;
      font-size: 1.1em;
      color: #333;
    }

    .drink-price {
      color: #ff6b6b;
      font-weight: 700;
      margin-left: 10px;
    }

    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    .option-group label {
      font-size: 14px;
      margin-bottom: 5px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    th {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 15px;
      font-weight: 600;
      text-align: left;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid #eee;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .order-actions {
      display: flex;
      gap: 5px;
    }

    .total-section {
      background: linear-gradient(45deg, #48cae4, #0077b6);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
    }

    .total-amount {
      font-size: 2em;
      font-weight: 700;
    }

    .search-box {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }

    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      min-width: 200px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      border-radius: 8px;
      z-index: 1000;
      border: 1px solid #ddd;
      overflow: hidden;
    }

    .dropdown-item {
      display: block;
      width: 100%;
      padding: 12px 16px;
      text-align: left;
      border: none;
      background: white;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }

    .dropdown-item:hover {
      background: #f8f9fa;
    }

    .dropdown-item:active {
      background: #e9ecef;
    }

    /* å½ˆå‡ºè¦–çª—æ¨£å¼ */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.5em;
    }

    .close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.3s;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .modal-body {
      padding: 20px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .edit-controls {
      display: flex;
      gap: 15px;
      align-items: end;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .edit-controls label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #555;
    }

    .edit-controls select {
      min-width: 200px;
    }

    .menu-edit-list {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: #f8f9fa;
      min-height: 300px;
    }

    .edit-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid #eee;
    }

    .edit-item input {
      flex: 1;
      margin: 0;
    }

    .edit-item .price-input {
      width: 80px;
    }

    .edit-item .delete-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .edit-item .delete-btn:hover {
      background: #ee5a52;
    }

    .modal-footer {
      padding: 20px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }

    @media (max-width: 768px) {
      .options {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 2em;
      }

      .content {
        padding: 15px;
      }

      .dropdown-content {
        min-width: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ§‹ é£²æ–™é»é¤ç³»çµ±</h1>
      <p>è¼•é¬†ç®¡ç†åœ˜é«”è¨‚é£²æ–™ï¼Œè®“é»é¤è®Šå¾—æ›´ç°¡å–®ï¼</p>
    </div>

    <div class="content">
      <!-- é£²æ–™åº—é¸æ“‡å€åŸŸ -->
      <div class="section">
        <h2>ğŸ“ é¸æ“‡é£²æ–™åº—</h2>
        <div class="form-group">
          <label for="store-select">é£²æ–™åº—ï¼š</label>
          <select id="store-select">
            <option value="">è«‹é¸æ“‡é£²æ–™åº—</option>
            <option value="milkshop">è¿·å®¢å¤ Milk Shop</option>
            <option value="50lan">50åµ</option>
            <option value="comebuy">æ¸…å¿ƒç¦å…¨</option>
            <option value="gongcha">è²¢èŒ¶</option>
            <option value="truedan">çç…®ä¸¹</option>
            <option value="songben">æ¾æœ¬é®®å¥¶èŒ¶</option>
            <option value="seventea">ä¸ƒç›èŒ¶</option>
            <option value="dejeng">å¾—æ­£</option>
            <option value="yimuday">ä¸€æ²æ—¥</option>
            <option value="custom">è‡ªè¨‚èœå–®</option>
          </select>
        </div>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
          <button class="btn" id="upload-menu-btn">ğŸ“ ä¸Šå‚³è‡ªè¨‚èœå–® (CSV)</button>
          <div class="dropdown" style="position: relative;">
            <button class="btn" id="download-menu-btn">ğŸ“¥ ä¸‹è¼‰èœå–®ç¯„æœ¬</button>
            <div class="dropdown-content" id="download-menu-dropdown" style="display: none;">
              <button class="dropdown-item" onclick="downloadMenuTemplate('csv')">ğŸ“„ CSV æ ¼å¼</button>
              <button class="dropdown-item" onclick="downloadMenuTemplate('excel')">ğŸ“Š Excel æ ¼å¼</button>
              <button class="dropdown-item" onclick="downloadMenuTemplate('json')">ğŸ”§ JSON æ ¼å¼</button>
              <button class="dropdown-item" onclick="downloadMenuTemplate('txt')">ğŸ“ æ–‡å­—æ ¼å¼</button>
            </div>
          </div>
          <button class="btn" id="edit-menu-btn">âœï¸ ç·¨è¼¯èœå–®</button>
        </div>
        <input type="file" id="menu-upload" accept=".csv" style="display:none" />
      </div>

      <!-- èœå–®é¡¯ç¤ºå€åŸŸ -->
      <div class="section" id="menu-section" style="display:none">
        <h2>ğŸ¹ èœå–®</h2>
        <div id="menu-container"></div>
      </div>

      <!-- è¨‚å–®ç®¡ç†å€åŸŸ -->
      <div class="section">
        <h2>ğŸ“‹ è¨‚å–®ç®¡ç†</h2>
        <input type="text" class="search-box" id="search-orders" placeholder="ğŸ” æœå°‹è€å¸«å§“åæˆ–é£²æ–™..." />

        <div class="total-section" id="total-section" style="display:none">
          <div>ç¸½è¨ˆé‡‘é¡</div>
          <div class="total-amount" id="total-amount">$0</div>
          <div id="order-count">å…± 0 æ¯é£²æ–™</div>
        </div>

        <div class="order-list" id="order-summary"></div>
        <div style="text-align: center; margin-top: 20px;">
          <button class="btn btn-success" id="download-csv" style="display:none">ğŸ“¥ ä¸‹è¼‰è¨‚å–® CSV</button>
          <button class="btn btn-danger" id="clear-all-orders" style="display:none">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰è¨‚å–®</button>
        </div>
      </div>
    </div>
  </div>

  <!-- èœå–®ç·¨è¼¯å½ˆå‡ºè¦–çª— -->
  <div id="menu-edit-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>âœï¸ ç·¨è¼¯èœå–®</h2>
        <button class="close-btn" onclick="closeMenuEditModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="edit-controls">
          <label for="edit-store-select">é¸æ“‡è¦ç·¨è¼¯çš„åº—å®¶ï¼š</label>
          <select id="edit-store-select">
            <option value="">è«‹é¸æ“‡åº—å®¶</option>
            <option value="milkshop">è¿·å®¢å¤ Milk Shop</option>
            <option value="50lan">50åµ</option>
            <option value="comebuy">æ¸…å¿ƒç¦å…¨</option>
            <option value="gongcha">è²¢èŒ¶</option>
            <option value="truedan">çç…®ä¸¹</option>
            <option value="songben">èŒ¶ä¹‹é­”æ‰‹</option>
            <option value="seventea">ä¸ƒç›èŒ¶</option>
            <option value="dejeng">å¾—æ­£</option>
            <option value="yimuday">ä¸€æ²æ—¥</option>
          </select>
          <button class="btn" onclick="addNewDrink()">â• æ–°å¢é£²æ–™</button>
        </div>

        <div id="menu-edit-list" class="menu-edit-list">
          <p>è«‹å…ˆé¸æ“‡è¦ç·¨è¼¯çš„åº—å®¶</p>
        </div>

        <div class="modal-footer">
          <button class="btn" onclick="saveMenuChanges()">ğŸ’¾ å„²å­˜è®Šæ›´</button>
          <button class="btn btn-secondary" onclick="closeMenuEditModal()">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const menus = {
  milkshop: [
    // æ„›èŒ¶çš„ç‰›ç³»åˆ— (Læ¯) - å—éƒ¨åƒ¹æ ¼
    { name: "å¨œæ¯ç´…èŒ¶ (L)", price: 35 },
    { name: "è‹±å€«ä¼¯çˆµç´…èŒ¶ (L)", price: 30 },
    { name: "å¤§æ­£é†‡é¦™ç´…èŒ¶ (L)", price: 30 },
    { name: "åŸç‰‡åˆéœ²é’èŒ¶ (L)", price: 30 },
    { name: "ç¥ç€é«˜å³°çƒé¾ (L)", price: 30 },
    { name: "æ°´ä¹‹æ£®ç„ç±³æŠ¹èŒ¶ (L)", price: 45 },
    // ç‰§å ´é®®å¥¶èŒ¶ç³»åˆ— - å—éƒ¨åƒ¹æ ¼
    { name: "å¨œæ¯ç´…èŒ¶æ‹¿éµ (M)", price: 50 },
    { name: "å¨œæ¯ç´…èŒ¶æ‹¿éµ (L)", price: 60 },
    { name: "ä¼¯çˆµç´…èŒ¶æ‹¿éµ (M)", price: 45 },
    { name: "ä¼¯çˆµç´…èŒ¶æ‹¿éµ (L)", price: 55 },
    { name: "å¤§æ­£ç´…èŒ¶æ‹¿éµ (M)", price: 45 },
    { name: "å¤§æ­£ç´…èŒ¶æ‹¿éµ (L)", price: 55 },
    { name: "ç¥ç€çƒé¾æ‹¿éµ (M)", price: 45 },
    { name: "ç¥ç€çƒé¾æ‹¿éµ (L)", price: 55 },
    { name: "èŒ‰é¦™ç¶ èŒ¶æ‹¿éµ (M)", price: 45 },
    { name: "èŒ‰é¦™ç¶ èŒ¶æ‹¿éµ (L)", price: 55 },
    { name: "çç ç´…èŒ¶æ‹¿éµ (M)", price: 55 },
    { name: "çç ç´…èŒ¶æ‹¿éµ (L)", price: 65 },
    // ç¶ å…‰ç‰§å ´é®®å¥¶ç³»åˆ— (Mæ¯) - å—éƒ¨åƒ¹æ ¼
    { name: "èŠ‹é ­é®®å¥¶ (M)", price: 65 },
    { name: "æ‰‹ç‚’é»‘ç³–é®®å¥¶ (M)", price: 65 },
    { name: "æ³•èŠ™å¨œç´”å¯å¯é®®å¥¶ (M)", price: 65 },
    { name: "ç„ç±³æŠ¹èŒ¶æ‹¿éµ (M)", price: 65 },
    { name: "çç é®®å¥¶ (M)", price: 65 },
    { name: "å«©ä»™è‰å‡å¥¶ (M)", price: 65 },
    // æ‰‹ä½œç‰¹èª¿ç³»åˆ— (Læ¯) - å—éƒ¨åƒ¹æ ¼
    { name: "ç†Ÿé‡€é’æ¢…ç¶  (L)", price: 55 },
    { name: "èœœæ¡ƒçƒé¾ (L)", price: 65 },
    { name: "ç™½ç”˜è”—é’èŒ¶ (L)", price: 65 },
    { name: "å†¬ç“œé’èŒ¶ (L)", price: 50 },
    { name: "æŸ³ä¸ç¶ èŒ¶ (L)", price: 60 },
    { name: "é’æª¸é¦™èŒ¶ (L)", price: 65 },
    { name: "èœ‚èœœæª¸æª¬æ™¶å‡ (L)", price: 55 },
    { name: "é¤Šæ¨‚å¤šç¶  (L)", price: 50 }
  ],
  "50lan": [
    // æ‰¾å¥½èŒ¶ç³»åˆ— - å—éƒ¨åƒ¹æ ¼
    { name: "èŒ‰è‰ç¶ èŒ¶ (M)", price: 30 },
    { name: "èŒ‰è‰ç¶ èŒ¶ (L)", price: 35 },
    { name: "é˜¿è–©å§†ç´…èŒ¶ (M)", price: 30 },
    { name: "é˜¿è–©å§†ç´…èŒ¶ (L)", price: 35 },
    { name: "å››å­£æ˜¥é’èŒ¶ (M)", price: 30 },
    { name: "å››å­£æ˜¥é’èŒ¶ (L)", price: 35 },
    { name: "é»ƒé‡‘çƒé¾ (M)", price: 30 },
    { name: "é»ƒé‡‘çƒé¾ (L)", price: 35 },
    { name: "æª¸æª¬ç¶  (M)", price: 45 },
    { name: "æª¸æª¬ç¶  (L)", price: 50 },
    { name: "æ¢…ã®ç¶  (M)", price: 45 },
    { name: "æ¢…ã®ç¶  (L)", price: 50 },
    { name: "æ¡”å­ç¶  (M)", price: 45 },
    { name: "æ¡”å­ç¶  (L)", price: 50 },
    { name: "8å†°ç¶  (M)", price: 45 },
    { name: "8å†°ç¶  (L)", price: 50 },
    { name: "é¤Šæ¨‚å¤šç¶  (M)", price: 45 },
    { name: "é¤Šæ¨‚å¤šç¶  (L)", price: 50 },
    { name: "æ—ºä¾†ç´… (M)", price: 45 },
    { name: "æ—ºä¾†ç´… (L)", price: 50 },
    { name: "æŸšå­ç´… (M)", price: 45 },
    { name: "æŸšå­ç´… (L)", price: 50 },
    { name: "é®®æŸšç¶  (M)", price: 55 },
    { name: "é®®æŸšç¶  (L)", price: 60 },
    // æ‰¾å£æ„Ÿç³»åˆ— - å—éƒ¨åƒ¹æ ¼
    { name: "å››å­£æ˜¥+çæ³¢æ¤° (M)", price: 35 },
    { name: "å››å­£æ˜¥+çæ³¢æ¤° (L)", price: 40 },
    { name: "æ³¢éœ¸ç´…èŒ¶ (M)", price: 35 },
    { name: "æ³¢éœ¸ç´…èŒ¶ (L)", price: 40 },
    { name: "æ³¢éœ¸ç¶ èŒ¶ (M)", price: 35 },
    { name: "æ³¢éœ¸ç¶ èŒ¶ (L)", price: 40 },
    { name: "æ³¢éœ¸é’èŒ¶ (M)", price: 35 },
    { name: "æ³¢éœ¸é’èŒ¶ (L)", price: 40 },
    { name: "æ³¢éœ¸çƒé¾ (M)", price: 35 },
    { name: "æ³¢éœ¸çƒé¾ (L)", price: 40 },
    { name: "æ³¢éœ¸å¥¶èŒ¶ (M)", price: 45 },
    { name: "æ³¢éœ¸å¥¶èŒ¶ (L)", price: 50 },
    { name: "æ³¢éœ¸å¥¶ç¶  (M)", price: 45 },
    { name: "æ³¢éœ¸å¥¶ç¶  (L)", price: 50 },
    { name: "æ³¢éœ¸çƒé¾å¥¶èŒ¶ (M)", price: 45 },
    { name: "æ³¢éœ¸çƒé¾å¥¶èŒ¶ (L)", price: 50 },
    { name: "çç ç´…èŒ¶ (M)", price: 35 },
    { name: "çç ç´…èŒ¶ (L)", price: 40 },
    { name: "çç ç¶ èŒ¶ (M)", price: 35 },
    { name: "çç ç¶ èŒ¶ (L)", price: 40 },
    { name: "çç é’èŒ¶ (M)", price: 35 },
    { name: "çç é’èŒ¶ (L)", price: 40 },
    { name: "çç çƒé¾ (M)", price: 35 },
    { name: "çç çƒé¾ (L)", price: 40 },
    { name: "çç å¥¶èŒ¶ (M)", price: 45 },
    { name: "çç å¥¶èŒ¶ (L)", price: 50 },
    { name: "çç å¥¶ç¶  (M)", price: 45 },
    { name: "çç å¥¶ç¶  (L)", price: 50 },
    { name: "æ¤°æœå¥¶èŒ¶ (M)", price: 45 },
    { name: "æ¤°æœå¥¶èŒ¶ (L)", price: 50 },
    { name: "å¸ƒä¸å¥¶èŒ¶ (M)", price: 55 },
    { name: "å¸ƒä¸å¥¶èŒ¶ (L)", price: 60 },
    { name: "å¸ƒä¸å¥¶ç¶  (M)", price: 55 },
    { name: "å¸ƒä¸å¥¶ç¶  (L)", price: 60 },
    { name: "å¸ƒä¸ç´…èŒ¶ (M)", price: 45 },
    { name: "å¸ƒä¸ç´…èŒ¶ (L)", price: 50 },
    { name: "å¸ƒä¸ç¶ èŒ¶ (M)", price: 45 },
    { name: "å¸ƒä¸ç¶ èŒ¶ (L)", price: 50 },
    { name: "å¸ƒä¸é’èŒ¶", price: 50 },
    { name: "å¸ƒä¸çƒé¾", price: 50 },
    // æ‰¾å¥¶èŒ¶ç³»åˆ—
    { name: "å¥¶èŒ¶", price: 50 },
    { name: "å¥¶ç¶ ", price: 50 },
    { name: "ç´…èŒ¶ç‘ªå¥‡æœµ", price: 50 },
    { name: "çƒé¾ç‘ªå¥‡æœµ", price: 50 },
    { name: "å››å­£å¥¶é’", price: 50 },
    { name: "é»ƒé‡‘çƒé¾å¥¶èŒ¶", price: 50 },
    { name: "é˜¿è¯ç”°", price: 55 },
    // æ‰¾æ–°é®®ç³»åˆ—
    { name: "æª¸æª¬æ±", price: 55 },
    { name: "é‡‘æ¡”æª¸æª¬", price: 55 },
    { name: "æª¸æª¬æ¢…æ±", price: 60 },
    { name: "æª¸æª¬é¤Šæ¨‚å¤š", price: 65 },
    { name: "8å†°èŒ¶", price: 50 },
    { name: "æŸšå­èŒ¶", price: 50 },
    { name: "é®®æŸšæ±", price: 65 },
    { name: "è‘¡è„æŸšå¤šå¤š", price: 65 },
    // ç´…èŒ¶æ‹¿éµç³»åˆ—
    { name: "ç´…èŒ¶æ‹¿éµ", price: 60 },
    { name: "ç¶ èŒ¶æ‹¿éµ", price: 60 },
    { name: "é»ƒé‡‘çƒé¾æ‹¿éµ", price: 60 },
    { name: "é˜¿è¯ç”°æ‹¿éµ", price: 65 },
    // æ‰¾å†°æ·‡æ·‹ç³»åˆ—
    { name: "å†°æ·‡æ·‹ç´…èŒ¶", price: 50 },
    { name: "èŠ’æœé’", price: 50 },
    { name: "è”æçƒé¾", price: 50 }
  ],
  comebuy: [
    { name: "ç´…èŒ¶", price: 25 },
    { name: "ç¶ èŒ¶", price: 25 },
    { name: "çƒé¾èŒ¶", price: 30 },
    { name: "çç å¥¶èŒ¶", price: 40 },
    { name: "çç ç¶ èŒ¶", price: 40 },
    { name: "æª¸æª¬ç¶ èŒ¶", price: 35 },
    { name: "å†¬ç“œèŒ¶", price: 30 },
    { name: "èœ‚èœœæª¸æª¬", price: 40 },
    { name: "å¤šå¤šç¶ èŒ¶", price: 45 },
    { name: "å¸ƒä¸å¥¶èŒ¶", price: 50 }
  ],
  gongcha: [
    { name: "é˜¿é‡Œå±±çƒé¾èŒ¶", price: 35 },
    { name: "èŒ‰è‰ç¶ èŒ¶", price: 35 },
    { name: "å››å­£æ˜¥èŒ¶", price: 35 },
    { name: "çç å¥¶èŒ¶", price: 55 },
    { name: "çç ç¶ èŒ¶", price: 55 },
    { name: "å¸ƒä¸å¥¶èŒ¶", price: 60 },
    { name: "èŠ‹é ­å¥¶èŒ¶", price: 65 },
    { name: "é»‘ç³–çç å¥¶èŒ¶", price: 70 },
    { name: "æ‹›ç‰Œå¥¶èŒ¶", price: 60 },
    { name: "æª¸æª¬èœœèŒ¶", price: 50 }
  ],
  truedan: [
    // åŒ å¿ƒè·äººé»‘ç³–ç³»åˆ—
    { name: "é»‘ç³–çç é®®å¥¶ (M)", price: 55 },
    { name: "é»‘ç³–çç é®®å¥¶ (L)", price: 65 },
    { name: "é»‘ç³–ç²‰ç²¿é®®å¥¶ (M)", price: 55 },
    { name: "é»‘ç³–ç²‰ç²¿é®®å¥¶ (L)", price: 65 },
    { name: "é»‘ç³–çç åšé®®å¥¶ (M)", price: 65 },
    { name: "é»‘ç³–çç åšé®®å¥¶ (L)", price: 75 },
    { name: "æ‰‹ç†¬é»‘ç³–å†¬ç“œèŒ¶ (L)", price: 45 },
    // ç…®ä¸¹ç§æˆ¿å¥¶èŒ¶ç³»åˆ—
    { name: "æ³¢æ³¢ç²¿ç²¿é®®å¥¶èŒ¶ (M)", price: 60 },
    { name: "æ³¢æ³¢ç²¿ç²¿é®®å¥¶èŒ¶ (L)", price: 70 },
    { name: "çç å¥¶èŒ¶ (M)", price: 50 },
    { name: "çç å¥¶èŒ¶ (L)", price: 60 },
    { name: "å§å§ç´…èŒ¶æ‹¿éµ (M)", price: 45 },
    { name: "å§å§ç´…èŒ¶æ‹¿éµ (L)", price: 55 },
    { name: "æ³°æ³°é®®å¥¶èŒ¶ (M)", price: 50 },
    { name: "æ³°æ³°é®®å¥¶èŒ¶ (L)", price: 60 },
    { name: "ç…®æ¯å¥¶èŒ¶ (M)", price: 40 },
    { name: "ç…®æ¯å¥¶èŒ¶ (L)", price: 50 },
    // å³¶å¶¼æœèŒ¶ç³»åˆ— (Læ¯é™å®š)
    { name: "é’æª¸æ¡‚èŠ±é‡€ç²¿ç²¿ (L)", price: 65 },
    { name: "è¥¿ç“œçƒé¾ (L)", price: 60 },
    { name: "æ©™é¦™ç¿¡ç¿  (L)", price: 55 },
    { name: "å¤šå¤šæ˜¥ (L)", price: 55 },
    { name: "è‘¡æŸšç¿¡ç¿  (L)", price: 60 },
    { name: "èœ‚èœœæª¸æª¬èŠèŠ±èŒ¶ (L)", price: 50 },
    // ä¸–ç•ŒèŒ¶å…‰è­œç³»åˆ— (Læ¯)
    { name: "é›²éœ§çƒé¾ (L)", price: 45 },
    { name: "ä¸çŸ¥æ˜¥ (L)", price: 40 },
    { name: "å¾©åˆ»ç´…èŒ¶ (L)", price: 35 },
    { name: "è€æ´¾è•éº¥ (L)", price: 40 }
  ],
  songben: [
    // èŒ¶ä¹‹é­”æ‰‹ - å°ç£èŒ—èŒ¶ç³»åˆ—
    { name: "å°ç£é›ç´… (ä¸­)", price: 25 },
    { name: "å°ç£é›ç´… (å¤§)", price: 30 },
    { name: "å°ç£ç´”ç¶  (ä¸­)", price: 25 },
    { name: "å°ç£ç´”ç¶  (å¤§)", price: 30 },
    { name: "å°ç£é’èŒ¶ (ä¸­)", price: 25 },
    { name: "å°ç£é’èŒ¶ (å¤§)", price: 30 },
    { name: "å°ç£çƒé¾ (ä¸­)", price: 25 },
    { name: "å°ç£çƒé¾ (å¤§)", price: 30 },
    // ä¼¯çˆµç´…èŒ¶ç³»åˆ—
    { name: "ä¼¯çˆµç´…èŒ¶ (ä¸­)", price: 25 },
    { name: "ä¼¯çˆµç´…èŒ¶ (å¤§)", price: 30 },
    { name: "çç ä¼¯çˆµ (ä¸­)", price: 30 },
    { name: "çç ä¼¯çˆµ (å¤§)", price: 35 },
    { name: "ä¼¯çˆµå¥¶èŒ¶ (ä¸­)", price: 40 },
    { name: "ä¼¯çˆµå¥¶èŒ¶ (å¤§)", price: 45 },
    { name: "ä¼¯çˆµé®®å¥¶èŒ¶ (ä¸­)", price: 45 },
    { name: "ä¼¯çˆµé®®å¥¶èŒ¶ (å¤§)", price: 55 },
    // å¥¶èŒ¶ç³»åˆ—
    { name: "å¥¶èŒ¶ (ä¸­)", price: 40 },
    { name: "å¥¶èŒ¶ (å¤§)", price: 45 },
    { name: "é®®å¥¶èŒ¶ (ä¸­)", price: 45 },
    { name: "é®®å¥¶èŒ¶ (å¤§)", price: 55 },
    { name: "çç å¥¶èŒ¶ (ä¸­)", price: 45 },
    { name: "çç å¥¶èŒ¶ (å¤§)", price: 50 },
    { name: "æ³¢éœ¸å¥¶èŒ¶ (ä¸­)", price: 45 },
    { name: "æ³¢éœ¸å¥¶èŒ¶ (å¤§)", price: 50 },
    // ç‰¹èª¿ç³»åˆ—
    { name: "æª¸æª¬ç´…èŒ¶ (ä¸­)", price: 45 },
    { name: "æª¸æª¬ç´…èŒ¶ (å¤§)", price: 50 },
    { name: "å†¬ç“œèŒ¶ (ä¸­)", price: 25 },
    { name: "å†¬ç“œèŒ¶ (å¤§)", price: 30 },
    { name: "å¤šå¤šç¶ èŒ¶ (ä¸­)", price: 40 },
    { name: "å¤šå¤šç¶ èŒ¶ (å¤§)", price: 45 }
  ],
  seventea: [
    // ç¶“å…¸èŒ¶ç³»åˆ—
    { name: "å±±èƒçƒé¾", price: 40 },
    { name: "èŒ‰è‰ç¶ èŒ¶", price: 35 },
    { name: "é˜¿è–©å§†ç´…èŒ¶", price: 35 },
    { name: "å››å­£æ˜¥èŒ¶", price: 35 },
    // å¥¶éœœç³»åˆ—
    { name: "å±±èƒçƒé¾å¥¶éœœ", price: 65 },
    { name: "èŒ‰è‰ç¶ èŒ¶å¥¶éœœ", price: 60 },
    { name: "é˜¿è–©å§†å¥¶éœœ", price: 60 },
    // é®®å¥¶èŒ¶ç³»åˆ—
    { name: "çƒé¾é®®å¥¶èŒ¶", price: 55 },
    { name: "èŒ‰è‰é®®å¥¶èŒ¶", price: 50 },
    { name: "é˜¿è–©å§†é®®å¥¶èŒ¶", price: 50 },
    { name: "çç å¥¶èŒ¶", price: 55 },
    // ç‰¹èª¿ç³»åˆ—
    { name: "æª¸æª¬èœœèŒ¶", price: 45 },
    { name: "èœ‚èœœæŸšå­èŒ¶", price: 50 },
    { name: "å†¬ç“œæª¸æª¬", price: 40 },
    { name: "å¤šå¤šç¶ èŒ¶", price: 45 }
  ],
  dejeng: [
    // çƒé¾èŒ¶ç³»åˆ—
    { name: "å„ªé…ªæ˜¥çƒé¾", price: 55 },
    { name: "èŠå£«å¥¶è“‹ç„™çƒé¾", price: 65 },
    { name: "çƒ˜å‰é®®å¥¶", price: 60 },
    { name: "ç„™çƒé¾", price: 40 },
    { name: "æ˜¥çƒé¾", price: 35 },
    { name: "å‡é ‚çƒé¾", price: 45 },
    // ç‰¹èª¿ç³»åˆ—
    { name: "æª¸æª¬çƒé¾", price: 50 },
    { name: "èœ‚èœœçƒé¾", price: 45 },
    { name: "å†¬ç“œçƒé¾", price: 40 },
    { name: "æŸšå­çƒé¾", price: 50 },
    // é®®å¥¶ç³»åˆ—
    { name: "çƒé¾é®®å¥¶èŒ¶", price: 55 },
    { name: "ç„™çƒé¾é®®å¥¶", price: 60 },
    { name: "çç çƒé¾é®®å¥¶", price: 65 },
    { name: "å¸ƒä¸çƒé¾é®®å¥¶", price: 70 }
  ],
  yimuday: [
    // æ‹›ç‰Œç³»åˆ—
    { name: "ä¸€æ²æ—¥æ‹›ç‰Œå¥¶èŒ¶", price: 50 },
    { name: "é»‘ç³–çç é®®å¥¶", price: 60 },
    { name: "èŠ‹é ­é®®å¥¶", price: 65 },
    { name: "æŠ¹èŒ¶æ‹¿éµ", price: 70 },
    // èŒ¶é¡ç³»åˆ—
    { name: "ç´…èŒ¶", price: 30 },
    { name: "ç¶ èŒ¶", price: 30 },
    { name: "çƒé¾èŒ¶", price: 35 },
    { name: "èŒ‰è‰èŠ±èŒ¶", price: 35 },
    // é®®å¥¶èŒ¶ç³»åˆ—
    { name: "çç å¥¶èŒ¶", price: 55 },
    { name: "å¸ƒä¸å¥¶èŒ¶", price: 60 },
    { name: "æ¤°æœå¥¶èŒ¶", price: 55 },
    { name: "ä»™è‰å‡å¥¶èŒ¶", price: 55 },
    // ç‰¹èª¿ç³»åˆ—
    { name: "æª¸æª¬ç¶ èŒ¶", price: 45 },
    { name: "èœ‚èœœæª¸æª¬", price: 50 },
    { name: "å†¬ç“œèŒ¶", price: 35 },
    { name: "å¤šå¤šç¶ èŒ¶", price: 50 }
  ]
};

let currentMenu = [];
let orders = [];
let filteredOrders = [];

// å¾æœ¬åœ°å­˜å„²è¼‰å…¥è¨‚å–®
function loadOrders() {
  const saved = localStorage.getItem('drinkOrders');
  if (saved) {
    orders = JSON.parse(saved);
    filteredOrders = [...orders];
    showOrders();
  }
}

// ä¿å­˜è¨‚å–®åˆ°æœ¬åœ°å­˜å„²
function saveOrders() {
  localStorage.setItem('drinkOrders', JSON.stringify(orders));
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  loadOrders();
});

document.getElementById('store-select').addEventListener('change', function() {
  const store = this.value;
  if (!store) {
    document.getElementById('menu-section').style.display = 'none';
    return;
  }

  if (store === 'custom') {
    document.getElementById('menu-upload').click();
    return;
  }

  currentMenu = menus[store] || [];
  showMenu(currentMenu);
});

document.getElementById('upload-menu-btn').onclick = () => {
  document.getElementById('menu-upload').click();
};

document.getElementById('menu-upload').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      if (results.data && results.data.length > 0) {
        // å–å¾—åº—å®¶åç¨±ï¼ˆå¾ç¬¬ä¸€ç­†è³‡æ–™ä¸­è®€å–ï¼‰
        const firstItem = results.data[0];
        const storeName = firstItem.store || firstItem['é£²æ–™åº—åç¨±'] || firstItem['åº—å®¶åç¨±'] || 'è‡ªè¨‚èœå–®';

        // ç¢ºä¿è³‡æ–™æ ¼å¼æ­£ç¢º
        currentMenu = results.data.map(item => ({
          name: item.name || item['é£²æ–™åç¨±'] || '',
          price: parseInt(item.price || item['åƒ¹æ ¼'] || 0)
        })).filter(item => item.name && item.price);

        if (currentMenu.length > 0) {
          // æ›´æ–°èœå–®æ¨™é¡Œé¡¯ç¤ºåº—å®¶åç¨±
          const menuTitle = document.querySelector('#menu-section h2');
          if (menuTitle) {
            menuTitle.textContent = `ğŸ¹ ${storeName} èœå–®`;
          }

          showMenu(currentMenu);
          alert(`æˆåŠŸè¼‰å…¥ ${storeName} çš„ ${currentMenu.length} é …é£²æ–™ï¼`);
        } else {
          alert('CSV æª”æ¡ˆæ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ç¢ºä¿åŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š\n- é£²æ–™åº—åç¨± (store)\n- é£²æ–™åç¨± (name)\n- åƒ¹æ ¼ (price)');
        }
      }
    },
    error: function(error) {
      alert('æª”æ¡ˆè®€å–å¤±æ•—ï¼š' + error.message);
    }
  });
});

// æœå°‹åŠŸèƒ½
document.getElementById('search-orders').addEventListener('input', function() {
  const searchTerm = this.value.toLowerCase();
  if (!searchTerm) {
    filteredOrders = [...orders];
  } else {
    filteredOrders = orders.filter(order =>
      order.teacher.toLowerCase().includes(searchTerm) ||
      order.drink.toLowerCase().includes(searchTerm)
    );
  }
  showOrders();
});

// æ¸…ç©ºæ‰€æœ‰è¨‚å–®
document.getElementById('clear-all-orders').addEventListener('click', function() {
  if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨‚å–®å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
    orders = [];
    filteredOrders = [];
    saveOrders();
    showOrders();
  }
});

// ä¸‹è¼‰èœå–®ç¯„æœ¬ä¸‹æ‹‰é¸å–®
document.getElementById('download-menu-btn').addEventListener('click', function(e) {
  e.stopPropagation();
  const dropdown = document.getElementById('download-menu-dropdown');
  dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
});

// é»æ“Šå…¶ä»–åœ°æ–¹é—œé–‰ä¸‹æ‹‰é¸å–®
document.addEventListener('click', function() {
  document.getElementById('download-menu-dropdown').style.display = 'none';
});

// ç·¨è¼¯èœå–®æŒ‰éˆ•äº‹ä»¶
document.getElementById('edit-menu-btn').addEventListener('click', function() {
  document.getElementById('menu-edit-modal').style.display = 'flex';
});

// ç·¨è¼¯åº—å®¶é¸æ“‡äº‹ä»¶
document.getElementById('edit-store-select').addEventListener('change', function() {
  const store = this.value;
  if (!store) {
    document.getElementById('menu-edit-list').innerHTML = '<p>è«‹å…ˆé¸æ“‡è¦ç·¨è¼¯çš„åº—å®¶</p>';
    return;
  }

  showEditMenu(store);
});

let currentEditStore = '';
let editingMenu = [];

function showMenu(menu) {
  if (!menu || menu.length === 0) {
    document.getElementById('menu-section').style.display = 'none';
    return;
  }

  document.getElementById('menu-section').style.display = 'block';
  const container = document.getElementById('menu-container');

  let html = '<form id="order-form">';
  html += '<div class="form-group">';
  html += '<label for="teacher-name">ğŸ‘¨â€ğŸ« è€å¸«å§“åï¼š</label>';
  html += '<input type="text" id="teacher-name" placeholder="è«‹è¼¸å…¥è€å¸«å§“å" required name="teacher" />';
  html += '</div>';

  html += '<div class="form-group">';
  html += '<label>ğŸ¹ é¸æ“‡é£²æ–™ï¼š</label>';
  html += '</div>';

  menu.forEach((item, idx) => {
    html += `<div class="menu-item" data-idx="${idx}">
      <div class="drink-info">
        <input type="radio" required name="drink" value="${item.name}" id="drink${idx}" data-price="${item.price}" />
        <label for="drink${idx}" class="drink-name">${item.name}</label>
        <span class="drink-price">$${item.price}</span>
      </div>
      <div class="options">
        <div class="option-group">
          <label>ğŸ¯ ç³–åº¦ï¼š</label>
          <select name="sugar${idx}">
            <option value="æ­£å¸¸">æ­£å¸¸</option>
            <option value="å°‘ç³–">å°‘ç³–</option>
            <option value="åŠç³–">åŠç³–</option>
            <option value="å¾®ç³–">å¾®ç³–</option>
            <option value="ç„¡ç³–">ç„¡ç³–</option>
          </select>
        </div>
        <div class="option-group">
          <label>ğŸ§Š å†°å¡Šï¼š</label>
          <select name="ice${idx}">
            <option value="æ­£å¸¸">æ­£å¸¸</option>
            <option value="å°‘å†°">å°‘å†°</option>
            <option value="å¾®å†°">å¾®å†°</option>
            <option value="å»å†°">å»å†°</option>
            <option value="ç†±">ç†±</option>
          </select>
        </div>
      </div>
    </div>`;
  });

  html += '<div style="text-align: center; margin-top: 20px;">';
  html += '<button type="submit" class="btn btn-success">âœ… åŠ å…¥è¨‚å–®</button>';
  html += '</div>';
  html += '</form>';

  container.innerHTML = html;

  // æ·»åŠ é¸æ“‡æ•ˆæœ
  const radioButtons = container.querySelectorAll('input[type="radio"]');
  radioButtons.forEach(radio => {
    radio.addEventListener('change', function() {
      // ç§»é™¤æ‰€æœ‰é¸ä¸­æ¨£å¼
      container.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('selected');
      });
      // æ·»åŠ é¸ä¸­æ¨£å¼
      this.closest('.menu-item').classList.add('selected');
    });
  });

  document.getElementById('order-form').onsubmit = function(e) {
    e.preventDefault();
    const fd = new FormData(this);
    const teacher = fd.get("teacher").trim();

    if (!teacher) {
      alert('è«‹è¼¸å…¥è€å¸«å§“åï¼');
      return;
    }

    let selectedDrink = null;
    let sugar = "";
    let ice = "";
    let price = 0;

    currentMenu.forEach((item, idx) => {
      if (fd.get("drink") === item.name) {
        selectedDrink = item.name;
        sugar = fd.get("sugar" + idx);
        ice = fd.get("ice" + idx);
        price = item.price;
      }
    });

    if (!selectedDrink) {
      alert('è«‹é¸æ“‡ä¸€é …é£²æ–™ï¼');
      return;
    }

    const newOrder = {
      id: Date.now(),
      teacher,
      drink: selectedDrink,
      sugar,
      ice,
      price,
      timestamp: new Date().toLocaleString('zh-TW')
    };

    orders.push(newOrder);
    filteredOrders = [...orders];
    saveOrders();
    showOrders();
    this.reset();

    // ç§»é™¤é¸ä¸­æ¨£å¼
    container.querySelectorAll('.menu-item').forEach(item => {
      item.classList.remove('selected');
    });

    alert(`âœ… å·²ç‚º ${teacher} è€å¸«åŠ å…¥è¨‚å–®ï¼š${selectedDrink}`);
  };
}

function showOrders() {
  const container = document.getElementById('order-summary');
  const totalSection = document.getElementById('total-section');
  const downloadBtn = document.getElementById('download-csv');
  const clearBtn = document.getElementById('clear-all-orders');

  if (orders.length === 0) {
    container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ğŸ“ é‚„æ²’æœ‰ä»»ä½•è¨‚å–®ï¼Œé–‹å§‹é»é¤å§ï¼</p>';
    totalSection.style.display = 'none';
    downloadBtn.style.display = 'none';
    clearBtn.style.display = 'none';
    return;
  }

  // è¨ˆç®—ç¸½è¨ˆ
  const totalAmount = orders.reduce((sum, order) => sum + (order.price || 0), 0);
  const totalCount = orders.length;

  // é¡¯ç¤ºç¸½è¨ˆ
  document.getElementById('total-amount').textContent = `$${totalAmount}`;
  document.getElementById('order-count').textContent = `å…± ${totalCount} æ¯é£²æ–™`;
  totalSection.style.display = 'block';

  // é¡¯ç¤ºè¨‚å–®è¡¨æ ¼
  let html = '<table>';
  html += '<tr><th>ğŸ‘¨â€ğŸ« è€å¸«</th><th>ğŸ¹ é£²æ–™</th><th>ğŸ¯ ç³–åº¦</th><th>ğŸ§Š å†°å¡Š</th><th>ğŸ’° åƒ¹æ ¼</th><th>â° æ™‚é–“</th><th>ğŸ› ï¸ æ“ä½œ</th></tr>';

  const ordersToShow = filteredOrders.length > 0 ? filteredOrders : orders;
  ordersToShow.forEach((order, index) => {
    html += `<tr>
      <td>${order.teacher}</td>
      <td>${order.drink}</td>
      <td>${order.sugar}</td>
      <td>${order.ice}</td>
      <td>$${order.price || 0}</td>
      <td>${order.timestamp || ''}</td>
      <td class="order-actions">
        <button class="btn btn-danger" onclick="deleteOrder(${order.id})" title="åˆªé™¤è¨‚å–®">ğŸ—‘ï¸</button>
        <button class="btn" onclick="editOrder(${order.id})" title="ç·¨è¼¯è¨‚å–®">âœï¸</button>
      </td>
    </tr>`;
  });

  html += '</table>';
  container.innerHTML = html;

  downloadBtn.style.display = 'inline-block';
  clearBtn.style.display = 'inline-block';
}

// åˆªé™¤è¨‚å–®
function deleteOrder(orderId) {
  if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨‚å–®å—ï¼Ÿ')) {
    orders = orders.filter(order => order.id !== orderId);
    filteredOrders = filteredOrders.filter(order => order.id !== orderId);
    saveOrders();
    showOrders();
  }
}

// ç·¨è¼¯è¨‚å–®
function editOrder(orderId) {
  const order = orders.find(o => o.id === orderId);
  if (!order) return;

  const newTeacher = prompt('ä¿®æ”¹è€å¸«å§“åï¼š', order.teacher);
  if (newTeacher === null) return; // ç”¨æˆ¶å–æ¶ˆ

  if (newTeacher.trim()) {
    order.teacher = newTeacher.trim();
    order.timestamp = new Date().toLocaleString('zh-TW') + ' (å·²ç·¨è¼¯)';

    // æ›´æ–° filteredOrders ä¸­çš„å°æ‡‰é …ç›®
    const filteredIndex = filteredOrders.findIndex(o => o.id === orderId);
    if (filteredIndex !== -1) {
      filteredOrders[filteredIndex] = order;
    }

    saveOrders();
    showOrders();
  }
}

document.getElementById('download-csv').onclick = function() {
  if (orders.length === 0) {
    alert('æ²’æœ‰è¨‚å–®å¯ä»¥ä¸‹è¼‰ï¼');
    return;
  }

  // æº–å‚™ CSV è³‡æ–™
  const csvData = orders.map(order => ({
    'è€å¸«å§“å': order.teacher,
    'é£²æ–™åç¨±': order.drink,
    'ç³–åº¦': order.sugar,
    'å†°å¡Š': order.ice,
    'åƒ¹æ ¼': order.price || 0,
    'è¨‚è³¼æ™‚é–“': order.timestamp || ''
  }));

  // æ·»åŠ ç¸½è¨ˆè¡Œ
  const totalAmount = orders.reduce((sum, order) => sum + (order.price || 0), 0);
  csvData.push({
    'è€å¸«å§“å': 'ç¸½è¨ˆ',
    'é£²æ–™åç¨±': `${orders.length} æ¯`,
    'ç³–åº¦': '',
    'å†°å¡Š': '',
    'åƒ¹æ ¼': totalAmount,
    'è¨‚è³¼æ™‚é–“': new Date().toLocaleString('zh-TW')
  });

  const csv = Papa.unparse(csvData);

  // æ·»åŠ  BOM ä»¥æ”¯æ´ä¸­æ–‡
  const BOM = '\uFEFF';
  const blob = new Blob([BOM + csv], {type: "text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;

  // ç”Ÿæˆæª”æ¡ˆåç¨±
  const now = new Date();
  const dateStr = now.toISOString().slice(0, 10);
  const timeStr = now.toTimeString().slice(0, 5).replace(':', '');
  a.download = `é£²æ–™è¨‚å–®_${dateStr}_${timeStr}.csv`;

  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  alert(`âœ… è¨‚å–®å·²ä¸‹è¼‰ï¼å…± ${orders.length} ç­†è¨‚å–®ï¼Œç¸½é‡‘é¡ $${totalAmount}`);
};

// ä¸‹è¼‰èœå–®ç¯„æœ¬åŠŸèƒ½
function downloadMenuTemplate(format) {
  // é—œé–‰ä¸‹æ‹‰é¸å–®
  document.getElementById('download-menu-dropdown').style.display = 'none';

  // æº–å‚™ç¯„æœ¬è³‡æ–™
  const templateData = [
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "ç´…èŒ¶", price: 30 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "ç¶ èŒ¶", price: 30 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "çƒé¾èŒ¶", price: 35 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "çç å¥¶èŒ¶", price: 50 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "çç ç¶ èŒ¶", price: 50 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "å¸ƒä¸å¥¶èŒ¶", price: 55 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "æ¤°æœå¥¶èŒ¶", price: 50 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "ä»™è‰å‡å¥¶èŒ¶", price: 55 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "èŠ‹é ­å¥¶èŒ¶", price: 60 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "æŠ¹èŒ¶æ‹¿éµ", price: 65 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "æª¸æª¬ç¶ èŒ¶", price: 40 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "èœ‚èœœæª¸æª¬", price: 45 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "å†¬ç“œèŒ¶", price: 35 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "é’è‰èŒ¶", price: 35 },
    { store: "ç¯„ä¾‹é£²æ–™åº—", name: "å¤šå¤šç¶ èŒ¶", price: 45 }
  ];

  const now = new Date();
  const dateStr = now.toISOString().slice(0, 10);
  const timeStr = now.toTimeString().slice(0, 5).replace(':', '');

  let content, mimeType, extension, filename;

  switch(format) {
    case 'csv':
      // CSV æ ¼å¼
      content = 'é£²æ–™åº—åç¨±,é£²æ–™åç¨±,åƒ¹æ ¼\n' + templateData.map(item => `${item.store},${item.name},${item.price}`).join('\n');
      content = '\uFEFF' + content; // æ·»åŠ  BOM æ”¯æ´ä¸­æ–‡
      mimeType = 'text/csv;charset=utf-8';
      extension = 'csv';
      break;

    case 'excel':
      // Excel ç›¸å®¹çš„ CSV æ ¼å¼
      content = 'é£²æ–™åº—åç¨±,é£²æ–™åç¨±,åƒ¹æ ¼\n' + templateData.map(item => `"${item.store}","${item.name}",${item.price}`).join('\n');
      content = '\uFEFF' + content; // æ·»åŠ  BOM æ”¯æ´ä¸­æ–‡
      mimeType = 'application/vnd.ms-excel;charset=utf-8';
      extension = 'csv';
      break;

    case 'json':
      // JSON æ ¼å¼
      content = JSON.stringify({
        "èªªæ˜": "é£²æ–™èœå–®ç¯„æœ¬ - è«‹ä¿®æ”¹ storeã€name å’Œ price æ¬„ä½",
        "æ ¼å¼": "æ¯å€‹é£²æ–™é …ç›®éœ€åŒ…å« storeï¼ˆé£²æ–™åº—åç¨±ï¼‰ã€nameï¼ˆé£²æ–™åç¨±ï¼‰å’Œ priceï¼ˆåƒ¹æ ¼ï¼‰",
        "æ¬„ä½èªªæ˜": {
          "store": "é£²æ–™åº—åç¨±ï¼ˆå¿…å¡«ï¼‰",
          "name": "é£²æ–™åç¨±ï¼ˆå¿…å¡«ï¼‰",
          "price": "åƒ¹æ ¼ï¼ˆå¿…å¡«ï¼Œæ•¸å­—ï¼‰"
        },
        "ç¯„ä¾‹": templateData,
        "èœå–®": templateData
      }, null, 2);
      mimeType = 'application/json;charset=utf-8';
      extension = 'json';
      break;

    case 'txt':
      // æ–‡å­—æ ¼å¼
      content = 'é£²æ–™èœå–®ç¯„æœ¬\n';
      content += '='.repeat(20) + '\n\n';
      content += 'æ ¼å¼èªªæ˜ï¼š\n';
      content += '- æ¯è¡Œä¸€å€‹é£²æ–™é …ç›®\n';
      content += '- æ ¼å¼ï¼šé£²æ–™åº—åç¨±,é£²æ–™åç¨±,åƒ¹æ ¼\n';
      content += '- è«‹å°‡æ­¤æª”æ¡ˆè½‰æ›ç‚º CSV æ ¼å¼å¾Œä¸Šå‚³\n\n';
      content += 'æ¬„ä½èªªæ˜ï¼š\n';
      content += '- é£²æ–™åº—åç¨±ï¼šæ‚¨çš„é£²æ–™åº—åç¨±ï¼ˆå¿…å¡«ï¼‰\n';
      content += '- é£²æ–™åç¨±ï¼šé£²æ–™çš„åç¨±ï¼ˆå¿…å¡«ï¼‰\n';
      content += '- åƒ¹æ ¼ï¼šé£²æ–™çš„åƒ¹æ ¼ï¼Œåªå¡«æ•¸å­—ï¼ˆå¿…å¡«ï¼‰\n\n';
      content += 'ç¯„ä¾‹èœå–®ï¼š\n';
      content += '-'.repeat(25) + '\n';
      content += 'é£²æ–™åº—åç¨±,é£²æ–™åç¨±,åƒ¹æ ¼\n';
      content += templateData.map(item => `${item.store},${item.name},${item.price}`).join('\n');
      content += '\n\n';
      content += 'ä½¿ç”¨èªªæ˜ï¼š\n';
      content += '1. è¤‡è£½ä¸Šæ–¹ç¯„ä¾‹èœå–®å…§å®¹\n';
      content += '2. ä¿®æ”¹é£²æ–™åº—åç¨±ã€é£²æ–™åç¨±å’Œåƒ¹æ ¼\n';
      content += '3. å„²å­˜ç‚º .csv æª”æ¡ˆ\n';
      content += '4. åœ¨ç³»çµ±ä¸­ä¸Šå‚³ CSV æª”æ¡ˆ\n';
      content += '5. ç³»çµ±æœƒè‡ªå‹•é¡¯ç¤ºæ‚¨çš„é£²æ–™åº—åç¨±\n';
      mimeType = 'text/plain;charset=utf-8';
      extension = 'txt';
      break;
  }

  filename = `èœå–®ç¯„æœ¬_${dateStr}_${timeStr}.${extension}`;

  // å»ºç«‹ä¸¦ä¸‹è¼‰æª”æ¡ˆ
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
  const formatNames = {
    'csv': 'CSV',
    'excel': 'Excel ç›¸å®¹ CSV',
    'json': 'JSON',
    'txt': 'æ–‡å­—'
  };

  alert(`âœ… ${formatNames[format]} æ ¼å¼èœå–®ç¯„æœ¬å·²ä¸‹è¼‰ï¼\næª”æ¡ˆåç¨±ï¼š${filename}\n\nåŒ…å« ${templateData.length} å€‹ç¯„ä¾‹é£²æ–™é …ç›®ï¼Œè«‹ä¿®æ”¹å¾Œä¸Šå‚³ä½¿ç”¨ã€‚`);
}

// é¡¯ç¤ºç·¨è¼¯èœå–®
function showEditMenu(store) {
  currentEditStore = store;
  editingMenu = JSON.parse(JSON.stringify(menus[store] || [])); // æ·±æ‹·è²

  const container = document.getElementById('menu-edit-list');

  if (editingMenu.length === 0) {
    container.innerHTML = '<p>æ­¤åº—å®¶ç›®å‰æ²’æœ‰èœå–®é …ç›®</p>';
    return;
  }

  let html = '';
  editingMenu.forEach((item, index) => {
    html += `
      <div class="edit-item" data-index="${index}">
        <input type="text" value="${item.name}" placeholder="é£²æ–™åç¨±" onchange="updateDrinkName(${index}, this.value)" />
        <span>$</span>
        <input type="number" class="price-input" value="${item.price}" min="0" placeholder="åƒ¹æ ¼" onchange="updateDrinkPrice(${index}, this.value)" />
        <button class="delete-btn" onclick="deleteDrink(${index})">ğŸ—‘ï¸</button>
      </div>
    `;
  });

  container.innerHTML = html;
}

// æ›´æ–°é£²æ–™åç¨±
function updateDrinkName(index, name) {
  if (editingMenu[index]) {
    editingMenu[index].name = name.trim();
  }
}

// æ›´æ–°é£²æ–™åƒ¹æ ¼
function updateDrinkPrice(index, price) {
  if (editingMenu[index]) {
    editingMenu[index].price = parseInt(price) || 0;
  }
}

// åˆªé™¤é£²æ–™
function deleteDrink(index) {
  if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹é£²æ–™é …ç›®å—ï¼Ÿ')) {
    editingMenu.splice(index, 1);
    showEditMenu(currentEditStore);
  }
}

// æ–°å¢é£²æ–™
function addNewDrink() {
  if (!currentEditStore) {
    alert('è«‹å…ˆé¸æ“‡è¦ç·¨è¼¯çš„åº—å®¶ï¼');
    return;
  }

  const name = prompt('è«‹è¼¸å…¥æ–°é£²æ–™åç¨±ï¼š');
  if (!name || !name.trim()) return;

  const price = prompt('è«‹è¼¸å…¥åƒ¹æ ¼ï¼š');
  const priceNum = parseInt(price);
  if (isNaN(priceNum) || priceNum < 0) {
    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„åƒ¹æ ¼ï¼');
    return;
  }

  editingMenu.push({
    name: name.trim(),
    price: priceNum
  });

  showEditMenu(currentEditStore);
}

// å„²å­˜èœå–®è®Šæ›´
function saveMenuChanges() {
  if (!currentEditStore) {
    alert('è«‹å…ˆé¸æ“‡è¦ç·¨è¼¯çš„åº—å®¶ï¼');
    return;
  }

  // é©—è­‰è³‡æ–™
  const validItems = editingMenu.filter(item => item.name && item.name.trim() && item.price >= 0);

  if (validItems.length === 0) {
    alert('è«‹è‡³å°‘ä¿ç•™ä¸€å€‹æœ‰æ•ˆçš„é£²æ–™é …ç›®ï¼');
    return;
  }

  if (confirm(`ç¢ºå®šè¦å„²å­˜å° ${getStoreName(currentEditStore)} èœå–®çš„è®Šæ›´å—ï¼Ÿ\n\nå°‡æœƒæ›´æ–° ${validItems.length} å€‹é£²æ–™é …ç›®ã€‚`)) {
    // æ›´æ–°èœå–®
    menus[currentEditStore] = validItems;

    // å¦‚æœç•¶å‰æ­£åœ¨é¡¯ç¤ºé€™å€‹åº—å®¶çš„èœå–®ï¼Œé‡æ–°è¼‰å…¥
    const currentStore = document.getElementById('store-select').value;
    if (currentStore === currentEditStore) {
      currentMenu = menus[currentEditStore];
      showMenu(currentMenu);
    }

    alert(`âœ… ${getStoreName(currentEditStore)} çš„èœå–®å·²æˆåŠŸæ›´æ–°ï¼`);
    closeMenuEditModal();
  }
}

// é—œé–‰ç·¨è¼¯è¦–çª—
function closeMenuEditModal() {
  document.getElementById('menu-edit-modal').style.display = 'none';
  document.getElementById('edit-store-select').value = '';
  document.getElementById('menu-edit-list').innerHTML = '<p>è«‹å…ˆé¸æ“‡è¦ç·¨è¼¯çš„åº—å®¶</p>';
  currentEditStore = '';
  editingMenu = [];
}

// ç²å–åº—å®¶åç¨±
function getStoreName(storeId) {
  const storeNames = {
    'milkshop': 'è¿·å®¢å¤ Milk Shop',
    '50lan': '50åµ',
    'comebuy': 'æ¸…å¿ƒç¦å…¨',
    'gongcha': 'è²¢èŒ¶',
    'truedan': 'çç…®ä¸¹',
    'songben': 'èŒ¶ä¹‹é­”æ‰‹',
    'seventea': 'ä¸ƒç›èŒ¶',
    'dejeng': 'å¾—æ­£',
    'yimuday': 'ä¸€æ²æ—¥'
  };
  return storeNames[storeId] || storeId;
}

</script>
</html>
